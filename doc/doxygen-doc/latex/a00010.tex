It can be desirable to include hwloc in a larger software package (be sure to check out the LICENSE file) so that users don't have to separately download and install it before installing your software. This can be advantageous to ensure that your software uses a known-\/tested/good version of hwloc, or for use on systems that do not have hwloc pre-\/installed.

When used in \char`\"{}embedded\char`\"{} mode, hwloc will:


\begin{DoxyItemize}
\item not install any header files
\item not build any documentation files
\item not build or install any executables or tests
\item not build {\ttfamily libhwloc.$\ast$} -\/-\/ instead, it will build {\ttfamily libhwloc\_\-embedded.$\ast$}
\end{DoxyItemize}

There are two ways to put hwloc into \char`\"{}embedded\char`\"{} mode. The first is directly from the configure command line:

\begin{DoxyVerb}
shell$ ./configure --enable-embedded-mode ...
\end{DoxyVerb}


The second requires that your software project uses the GNU Autoconf / Automake / Libtool tool chain to build your software. If you do this, you can directly integrate hwloc's m4 configure macro into your configure script. You can then invoke hwloc's configuration tests and build setup by calling an m4 macro (see below).\hypertarget{a00010_embedding_m4}{}\section{Using hwloc's M4 Embedding Capabilities}\label{a00010_embedding_m4}
Every project is different, and there are many different ways of integrating hwloc into yours. What follows is {\itshape one\/} example of how to do it.

If your project uses recent versions Autoconf, Automake, and Libtool to build, you can use hwloc's embedded m4 capabilities. We have tested the embedded m4 with projects that use Autoconf 2.65, Automake 1.11.1, and Libtool 2.2.6b. Slightly earlier versions of may also work but are untested. Autoconf versions prior to 2.65 are almost certain to not work.

You can either copy all the config/hwloc$\ast$m4 files from the hwloc source tree to the directory where your project's m4 files reside, or you can tell aclocal to find more m4 files in the embedded hwloc's \char`\"{}config\char`\"{} subdirectory (e.g., add \char`\"{}-\/Ipath/to/embedded/hwloc/config\char`\"{} to your Makefile.am's ACLOCAL\_\-AMFLAGS).

The following macros can then be used from your configure script (only HWLOC\_\-SETUP\_\-CORE {\itshape must\/} be invoked if using the m4 macros):


\begin{DoxyItemize}
\item HWLOC\_\-SETUP\_\-CORE(config-\/dir-\/prefix, action-\/upon-\/success, action-\/upon-\/failure, print\_\-banner\_\-or\_\-not): Invoke the hwloc configuration tests and setup the hwloc tree to build. The first argument is the prefix to use for AC\_\-OUTPUT files -\/-\/ it's where the hwloc tree is located relative to {\ttfamily \$top\_\-srcdir}. Hence, if your embedded hwloc is located in the source tree at contrib/hwloc, you should pass {\ttfamily \mbox{[}contrib/hwloc\mbox{]}} as the first argument. If HWLOC\_\-SETUP\_\-CORE and the rest of {\ttfamily configure} completes successfully, then \char`\"{}make\char`\"{} traversals of the hwloc tree with standard Automake targets (all, clean, install, etc.) should behave as expected. For example, it is safe to list the hwloc directory in the SUBDIRS of a higher-\/level Makefile.am. The last argument, if not empty, will cause the macro to display an announcement banner that it is starting the hwloc core configuration tests.
\end{DoxyItemize}

HWLOC\_\-SETUP\_\-CORE will set the following environment variables and AC\_\-SUBST them: HWLOC\_\-EMBEDDED\_\-CFLAGS, HWLOC\_\-EMBEDDED\_\-CPPFLAGS, and HWLOC\_\-EMBEDDED\_\-LIBS. These flags are filled with the values discovered in the hwloc-\/specific m4 tests, and can be used in your build process as relevant. The \_\-CFLAGS, \_\-CPPFLAGS, and \_\-LIBS variables are necessary to build libhwloc (or libhwloc\_\-embedded) itself.

HWLOC\_\-SETUP\_\-CORE also sets HWLOC\_\-EMBEDDED\_\-LDADD environment variable (and AC\_\-SUBSTs it) to contain the location of the libhwloc\_\-embedded.la convenience Libtool archive. It can be used in your build process to link an application or other library against the embedded hwloc library.

{\bfseries NOTE: If the HWLOC\_\-SET\_\-SYMBOL\_\-PREFIX macro is used, it must be invoked {\itshape before\/} HWLOC\_\-SETUP\_\-CORE.}


\begin{DoxyItemize}
\item HWLOC\_\-BUILD\_\-STANDALONE: HWLOC\_\-SETUP\_\-CORE defaults to building hwloc in an \char`\"{}embedded\char`\"{} mode (described above). If HWLOC\_\-BUILD\_\-STANDALONE is invoked $\ast$before$\ast$ HWLOC\_\-SETUP\_\-CORE, the embedded definitions will not apply (e.g., libhwloc.la will be built, not libhwloc\_\-embedded.la).
\end{DoxyItemize}


\begin{DoxyItemize}
\item HWLOC\_\-SET\_\-SYMBOL\_\-PREFIX(foo\_\-): Tells the hwloc to prefix all of hwloc's types and public symbols with \char`\"{}foo\_\-\char`\"{}; meaning that function hwloc\_\-init() becomes foo\_\-hwloc\_\-init(). Enum values are prefixed with an upper-\/case translation if the prefix supplied; HWLOC\_\-OBJ\_\-SYSTEM becomes FOO\_\-HWLOC\_\-OBJ\_\-SYSTEM. This is recommended behavior if you are including hwloc in middleware -\/-\/ it is possible that your software will be combined with other software that links to another copy of hwloc. If both uses of hwloc utilize different symbol prefixes, there will be no type/symbol clashes, and everything will compile, link, and run successfully. If you both embed hwloc without changing the symbol prefix and also link against an external hwloc, you may get multiple symbol definitions when linking your final library or application.
\end{DoxyItemize}


\begin{DoxyItemize}
\item HWLOC\_\-SETUP\_\-DOCS, HWLOC\_\-SETUP\_\-UTILS, HWLOC\_\-SETUP\_\-TESTS: These three macros only apply when hwloc is built in \char`\"{}standalone\char`\"{} mode (i.e., they should NOT be invoked unless HWLOC\_\-BUILD\_\-STANDALONE has already been invoked).
\end{DoxyItemize}


\begin{DoxyItemize}
\item HWLOC\_\-DO\_\-AM\_\-CONDITIONALS: If you embed hwloc in a larger project and build it conditionally with Automake (e.g., if HWLOC\_\-SETUP\_\-CORE is invoked conditionally), you must unconditionally invoke HWLOC\_\-DO\_\-AM\_\-CONDITIONALS to avoid warnings from Automake (for the cases where hwloc is not selected to be built). This macro is necessary because hwloc uses some AM\_\-CONDITIONALs to build itself, and AM\_\-CONDITIONALs cannot be defined conditionally. Note that it is safe (but unnecessary) to call HWLOC\_\-DO\_\-AM\_\-CONDITIONALS even if HWLOC\_\-SETUP\_\-CORE is invoked unconditionally. If you are not using Automake to build hwloc, this macro is unnecessary (and will actually cause errors because it invoked AM\_\-$\ast$ macros that will be undefined).
\end{DoxyItemize}

{\bfseries NOTE:} When using the HWLOC\_\-SETUP\_\-CORE m4 macro, it may be necessary to explicitly invoke AC\_\-CANONICAL\_\-TARGET (which requires config.sub and config.guess) and/or AC\_\-USE\_\-SYSTEM\_\-EXTENSIONS macros early in the configure script (e.g., after AC\_\-INIT but before AM\_\-INIT\_\-AUTOMAKE). See the Autoconf documentation for further information.

Also note that hwloc's top-\/level configure.ac script uses exactly the macros described above to build hwloc in a standalone mode (by default). You may want to examine it for one example of how these macros are used.\hypertarget{a00010_embedding_example}{}\section{Example Embedding hwloc}\label{a00010_embedding_example}
Here's an example of integrating with a larger project named sandbox that already uses Autoconf, Automake, and Libtool to build itself:

\begin{DoxyVerb}
# First, cd into the sandbox project source tree
shell$ cd sandbox
shell$ cp -r /somewhere/else/hwloc-<version> my-embedded-hwloc
shell$ edit Makefile.am
  1. Add "-Imy-embedded-hwloc/config" to ACLOCAL_AMFLAGS
  2. Add "my-embedded-hwloc" to SUBDIRS
  3. Add "$(HWLOC_EMBEDDED_LDADD)" and "$(HWLOC_EMBEDDED_LIBS)" to 
     sandbox's executable's LDADD line.  The former is the name of the 
     Libtool convenience library that hwloc will generate.  The latter 
     is any dependent support libraries that may be needed by 
     $(HWLOC_EMBEDDED_LDADD).
  4. Add "$(HWLOC_EMBEDDED_CFLAGS)" to AM_CFLAGS
  5. Add "$(HWLOC_EMBEDDED_CPPFLAGS)" to AM_CPPFLAGS
shell$ edit configure.ac
  1. Add "HWLOC_SET_SYMBOL_PREFIX(sandbox_hwloc_)" line
  2. Add "HWLOC_SETUP_CORE([my-embedded-hwloc], [happy=yes], [happy=no])" line
  3. Add error checking for happy=no case
shell$ edit sandbox.c
  1. Add #include <hwloc.h>
  2. Add calls to sandbox_hwloc_init() and other hwloc API functions
\end{DoxyVerb}


Now you can bootstrap, configure, build, and run the sandbox as normal -\/-\/ all calls to \char`\"{}sandbox\_\-hwloc\_\-$\ast$\char`\"{} will use the embedded hwloc rather than any system-\/provided copy of hwloc. 