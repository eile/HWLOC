\hypertarget{a00030_source}{
\section{glibc-\/sched.h}
}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * Copyright © 2009 CNRS}
00003 \textcolor{comment}{ * Copyright © 2009-2010 inria.  All rights reserved.}
00004 \textcolor{comment}{ * Copyright © 2009-2011 Université Bordeaux 1}
00005 \textcolor{comment}{ * Copyright © 2011 Cisco Systems, Inc.  All rights reserved.}
00006 \textcolor{comment}{ * See COPYING in top-level directory.}
00007 \textcolor{comment}{ */}
00008 
00017 \textcolor{preprocessor}{#ifndef HWLOC\_GLIBC\_SCHED\_H}
00018 \textcolor{preprocessor}{}\textcolor{preprocessor}{#define HWLOC\_GLIBC\_SCHED\_H}
00019 \textcolor{preprocessor}{}
00020 \textcolor{preprocessor}{#include <hwloc.h>}
00021 \textcolor{preprocessor}{#include <hwloc/helper.h>}
00022 \textcolor{preprocessor}{#include <assert.h>}
00023 
00024 \textcolor{preprocessor}{#if !defined \_GNU\_SOURCE || !defined \_SCHED\_H || (!defined CPU\_SETSIZE && !define
      d sched\_priority)}
00025 \textcolor{preprocessor}{}\textcolor{preprocessor}{#error Please make sure to include sched.h before including glibc-sched.h, and de
      fine \_GNU\_SOURCE before any inclusion of sched.h}
00026 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
00027 \textcolor{preprocessor}{}
00028 
00029 \textcolor{preprocessor}{#ifdef \_\_cplusplus}
00030 \textcolor{preprocessor}{}\textcolor{keyword}{extern} \textcolor{stringliteral}{"C"} \{
00031 \textcolor{preprocessor}{#endif}
00032 \textcolor{preprocessor}{}
00033 
00034 \textcolor{preprocessor}{#ifdef HWLOC\_HAVE\_CPU\_SET}
00035 \textcolor{preprocessor}{}
00036 
00049 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\hypertarget{a00030_source_l00050}{}\hyperlink{a00066_ga39454e6013441d32e58ef4c4fcba7e4b}{00050} \hyperlink{a00066_ga39454e6013441d32e58ef4c4fcba7e4b}{hwloc_cpuset_to_glibc_sched_affinity}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology \_\_hwloc\_attribute\_
      unused, \hyperlink{a00040_ga1f784433e9b606261f62d1134f6a3b25}{hwloc_const_cpuset_t} hwlocset,
00051                                     cpu\_set\_t *schedset, \textcolor{keywordtype}{size\_t} schedsetsize)
00052 \{
00053 \textcolor{preprocessor}{#ifdef CPU\_ZERO\_S}
00054 \textcolor{preprocessor}{}  \textcolor{keywordtype}{unsigned} cpu;
00055   CPU\_ZERO\_S(schedsetsize, schedset);
00056   \hyperlink{a00065_ga3f6861045a8029ade373510ffa727d2a}{hwloc_bitmap_foreach_begin}(cpu, hwlocset)
00057     CPU\_SET\_S(cpu, schedsetsize, schedset);
00058   \hyperlink{a00065_gafcf3246db406218d4e155735b3fa6528}{hwloc_bitmap_foreach_end}();
00059 \textcolor{preprocessor}{#else }\textcolor{comment}{/* !CPU\_ZERO\_S */}
00060   \textcolor{keywordtype}{unsigned} cpu;
00061   CPU\_ZERO(schedset);
00062   assert(schedsetsize == \textcolor{keyword}{sizeof}(cpu\_set\_t));
00063   \hyperlink{a00065_ga3f6861045a8029ade373510ffa727d2a}{hwloc_bitmap_foreach_begin}(cpu, hwlocset)
00064     CPU\_SET(cpu, schedset);
00065   \hyperlink{a00065_gafcf3246db406218d4e155735b3fa6528}{hwloc_bitmap_foreach_end}();
00066 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* !CPU\_ZERO\_S */}
00067   \textcolor{keywordflow}{return} 0;
00068 \}
00069 
00077 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\hypertarget{a00030_source_l00078}{}\hyperlink{a00066_ga6df504b2f5440b527be05cdad6b1655e}{00078} \hyperlink{a00066_ga6df504b2f5440b527be05cdad6b1655e}{hwloc_cpuset_from_glibc_sched_affinity}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology \_\_hwloc\_attribut
      e\_unused, \hyperlink{a00040_ga4bbf39b68b6f568fb92739e7c0ea7801}{hwloc_cpuset_t} hwlocset,
00079                                        \textcolor{keyword}{const} cpu\_set\_t *schedset, \textcolor{keywordtype}{size\_t} schedset
      size)
00080 \{
00081   \textcolor{keywordtype}{int} cpu;
00082 \textcolor{preprocessor}{#ifdef CPU\_ZERO\_S}
00083 \textcolor{preprocessor}{}  \textcolor{keywordtype}{int} count;
00084 \textcolor{preprocessor}{#endif}
00085 \textcolor{preprocessor}{}  \hyperlink{a00065_ga6c540b9fe63b8223b6aba46d56dd63b8}{hwloc_bitmap_zero}(hwlocset);
00086 \textcolor{preprocessor}{#ifdef CPU\_ZERO\_S}
00087 \textcolor{preprocessor}{}  count = CPU\_COUNT\_S(schedsetsize, schedset);
00088   cpu = 0;
00089   \textcolor{keywordflow}{while} (count) \{
00090     \textcolor{keywordflow}{if} (CPU\_ISSET\_S(cpu, schedsetsize, schedset)) \{
00091       \hyperlink{a00065_ga497556af0cc34f109ae0277999c074d3}{hwloc_bitmap_set}(hwlocset, cpu);
00092       count--;
00093     \}
00094     cpu++;
00095   \}
00096 \textcolor{preprocessor}{#else }\textcolor{comment}{/* !CPU\_ZERO\_S */}
00097   \textcolor{comment}{/* sched.h does not support dynamic cpu\_set\_t (introduced in glibc 2.7),}
00098 \textcolor{comment}{   * assume we have a very old interface without CPU\_COUNT (added in 2.6)}
00099 \textcolor{comment}{   */}
00100   assert(schedsetsize == \textcolor{keyword}{sizeof}(cpu\_set\_t));
00101   \textcolor{keywordflow}{for}(cpu=0; cpu<CPU\_SETSIZE; cpu++)
00102     \textcolor{keywordflow}{if} (CPU\_ISSET(cpu, schedset))
00103       \hyperlink{a00065_ga497556af0cc34f109ae0277999c074d3}{hwloc_bitmap_set}(hwlocset, cpu);
00104 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* !CPU\_ZERO\_S */}
00105   \textcolor{keywordflow}{return} 0;
00106 \}
00107 
00111 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* CPU\_SET */}
00112 
00113 
00114 \textcolor{preprocessor}{#ifdef \_\_cplusplus}
00115 \textcolor{preprocessor}{}\} \textcolor{comment}{/* extern "C" */}
00116 \textcolor{preprocessor}{#endif}
00117 \textcolor{preprocessor}{}
00118 
00119 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HWLOC\_GLIBC\_SCHED\_H */}
\end{DoxyCode}
