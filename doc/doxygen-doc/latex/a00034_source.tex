\hypertarget{a00034_source}{
\section{linux-\/libnuma.h}
}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * Copyright © 2009 CNRS}
00003 \textcolor{comment}{ * Copyright © 2009-2012 inria.  All rights reserved.}
00004 \textcolor{comment}{ * Copyright © 2009-2010, 2012 Université Bordeaux 1}
00005 \textcolor{comment}{ * See COPYING in top-level directory.}
00006 \textcolor{comment}{ */}
00007 
00026 \textcolor{preprocessor}{#ifndef HWLOC\_LINUX\_LIBNUMA\_H}
00027 \textcolor{preprocessor}{}\textcolor{preprocessor}{#define HWLOC\_LINUX\_LIBNUMA\_H}
00028 \textcolor{preprocessor}{}
00029 \textcolor{preprocessor}{#include <hwloc.h>}
00030 \textcolor{preprocessor}{#include <numa.h>}
00031 
00032 
00033 \textcolor{preprocessor}{#ifdef \_\_cplusplus}
00034 \textcolor{preprocessor}{}\textcolor{keyword}{extern} \textcolor{stringliteral}{"C"} \{
00035 \textcolor{preprocessor}{#endif}
00036 \textcolor{preprocessor}{}
00037 
00053 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\hypertarget{a00034_source_l00054}{}\hyperlink{a00068_ga018e57a42a780ce2ba2e35ef975d8888}{00054} \hyperlink{a00068_ga018e57a42a780ce2ba2e35ef975d8888}{hwloc_cpuset_to_linux_libnuma_ulongs}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology, 
      \hyperlink{a00040_ga1f784433e9b606261f62d1134f6a3b25}{hwloc_const_cpuset_t} cpuset,
00055                                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *mask, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *maxnode)
00056 \{
00057   \textcolor{keywordtype}{int} depth = \hyperlink{a00046_gaea7c64dd59467f5201ba87712710b14d}{hwloc_get_type_depth}(topology, \hyperlink{a00041_ggacd37bb612667dc437d66bfb175a8dc55aaf0964881117bdedf1a5e9332cd120dd}{HWLOC_OBJ_NODE});
00058   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} outmaxnode = -1;
00059 
00060   \textcolor{comment}{/* round-up to the next ulong and clear all bytes */}
00061   *maxnode = (*maxnode + 8*\textcolor{keyword}{sizeof}(*mask) - 1) & ~(8*\textcolor{keyword}{sizeof}(*mask) - 1);
00062   memset(mask, 0, *maxnode/8);
00063 
00064   \textcolor{keywordflow}{if} (depth != \hyperlink{a00046_ggaf4e663cf42bbe20756b849c6293ef575a0565ab92ab72cb0cec91e23003294aad}{HWLOC_TYPE_DEPTH_UNKNOWN}) \{
00065     \hyperlink{a00016}{hwloc_obj_t} node = NULL;
00066     \textcolor{keywordflow}{while} ((node = \hyperlink{a00056_ga2f9a4ec15e9cfae8c21501257a51ce5b}{hwloc_get_next_obj_covering_cpuset_by_depth}(topology, cpuset, 
      depth, node)) != NULL) \{
00067       \textcolor{keywordflow}{if} (node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index} >= *maxnode)
00068         \textcolor{keywordflow}{continue};
00069       mask[node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index}/\textcolor{keyword}{sizeof}(*mask)/8] |= 1UL << (node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index} % (\textcolor{keyword}{sizeof}(*m
      ask)*8));
00070       \textcolor{keywordflow}{if} (outmaxnode == (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}) -1 || outmaxnode < node->os\_index)
00071         outmaxnode = node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index};
00072     \}
00073 
00074   \} \textcolor{keywordflow}{else} \{
00075     \textcolor{comment}{/* if no numa, libnuma assumes we have a single node */}
00076     \textcolor{keywordflow}{if} (!\hyperlink{a00065_gaa94fed35d2a598bc4a8657b6955b7bf5}{hwloc_bitmap_iszero}(cpuset)) \{
00077       mask[0] = 1;
00078       outmaxnode = 0;
00079     \}
00080   \}
00081 
00082   *maxnode = outmaxnode+1;
00083   \textcolor{keywordflow}{return} 0;
00084 \}
00085 
00096 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\hypertarget{a00034_source_l00097}{}\hyperlink{a00068_gaf213df50d229c5d17a5a56b5d8f10b74}{00097} \hyperlink{a00068_gaf213df50d229c5d17a5a56b5d8f10b74}{hwloc_nodeset_to_linux_libnuma_ulongs}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology, 
      \hyperlink{a00040_ga2f5276235841ad66a79bedad16a5a10c}{hwloc_const_nodeset_t} nodeset,
00098                                       \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *mask, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *maxnode
      )
00099 \{
00100   \textcolor{keywordtype}{int} depth = \hyperlink{a00046_gaea7c64dd59467f5201ba87712710b14d}{hwloc_get_type_depth}(topology, \hyperlink{a00041_ggacd37bb612667dc437d66bfb175a8dc55aaf0964881117bdedf1a5e9332cd120dd}{HWLOC_OBJ_NODE});
00101   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} outmaxnode = -1;
00102 
00103   \textcolor{comment}{/* round-up to the next ulong and clear all bytes */}
00104   *maxnode = (*maxnode + 8*\textcolor{keyword}{sizeof}(*mask) - 1) & ~(8*\textcolor{keyword}{sizeof}(*mask) - 1);
00105   memset(mask, 0, *maxnode/8);
00106 
00107   \textcolor{keywordflow}{if} (depth != \hyperlink{a00046_ggaf4e663cf42bbe20756b849c6293ef575a0565ab92ab72cb0cec91e23003294aad}{HWLOC_TYPE_DEPTH_UNKNOWN}) \{
00108     \hyperlink{a00016}{hwloc_obj_t} node = NULL;
00109     \textcolor{keywordflow}{while} ((node = \hyperlink{a00053_gab7c1dce3f42ece5bfa621e87cf332418}{hwloc_get_next_obj_by_depth}(topology, depth, node)) != NULL) \{
      
00110       \textcolor{keywordflow}{if} (node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index} >= *maxnode)
00111         \textcolor{keywordflow}{continue};
00112       \textcolor{keywordflow}{if} (!\hyperlink{a00065_ga2583f44cbdb5fff2ea40efdcf3975d3f}{hwloc_bitmap_isset}(nodeset, node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index}))
00113         \textcolor{keywordflow}{continue};
00114       mask[node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index}/\textcolor{keyword}{sizeof}(*mask)/8] |= 1UL << (node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index} % (\textcolor{keyword}{sizeof}(*m
      ask)*8));
00115       \textcolor{keywordflow}{if} (outmaxnode == (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}) -1 || outmaxnode < node->os\_index)
00116         outmaxnode = node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index};
00117     \}
00118 
00119   \} \textcolor{keywordflow}{else} \{
00120     \textcolor{comment}{/* if no numa, libnuma assumes we have a single node */}
00121     \textcolor{keywordflow}{if} (!\hyperlink{a00065_gaa94fed35d2a598bc4a8657b6955b7bf5}{hwloc_bitmap_iszero}(nodeset)) \{
00122       mask[0] = 1;
00123       outmaxnode = 0;
00124     \}
00125   \}
00126 
00127   *maxnode = outmaxnode+1;
00128   \textcolor{keywordflow}{return} 0;
00129 \}
00130 
00140 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\hypertarget{a00034_source_l00141}{}\hyperlink{a00068_gafa60816dde33d69149497bcf6c7818e0}{00141} \hyperlink{a00068_gafa60816dde33d69149497bcf6c7818e0}{hwloc_cpuset_from_linux_libnuma_ulongs}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology, \hyperlink{a00040_ga4bbf39b68b6f568fb92739e7c0ea7801}{hwloc_cpuset_t} 
      cpuset,
00142                                       \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *mask, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} ma
      xnode)
00143 \{
00144   \textcolor{keywordtype}{int} depth = \hyperlink{a00046_gaea7c64dd59467f5201ba87712710b14d}{hwloc_get_type_depth}(topology, \hyperlink{a00041_ggacd37bb612667dc437d66bfb175a8dc55aaf0964881117bdedf1a5e9332cd120dd}{HWLOC_OBJ_NODE});
00145 
00146   \textcolor{keywordflow}{if} (depth != \hyperlink{a00046_ggaf4e663cf42bbe20756b849c6293ef575a0565ab92ab72cb0cec91e23003294aad}{HWLOC_TYPE_DEPTH_UNKNOWN}) \{
00147     \hyperlink{a00016}{hwloc_obj_t} node = NULL;
00148     \hyperlink{a00065_ga6c540b9fe63b8223b6aba46d56dd63b8}{hwloc_bitmap_zero}(cpuset);
00149     \textcolor{keywordflow}{while} ((node = \hyperlink{a00053_gab7c1dce3f42ece5bfa621e87cf332418}{hwloc_get_next_obj_by_depth}(topology, depth, node)) != NULL)
00150       \textcolor{keywordflow}{if} (node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index} < maxnode
00151           && (mask[node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index}/\textcolor{keyword}{sizeof}(*mask)/8] & (1UL << (node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index} % (\textcolor{keyword}{s
      izeof}(*mask)*8)))))
00152         \hyperlink{a00065_ga1ba1de709ee9a7cf5cc8ad2d9a1a81d4}{hwloc_bitmap_or}(cpuset, cpuset, node->\hyperlink{a00016_a67925e0f2c47f50408fbdb9bddd0790f}{cpuset});
00153   \} \textcolor{keywordflow}{else} \{
00154     \textcolor{comment}{/* if no numa, libnuma assumes we have a single node */}
00155     \textcolor{keywordflow}{if} (mask[0] & 1)
00156       \hyperlink{a00065_gab14743355fa03b36cef521cbcd2fbf64}{hwloc_bitmap_copy}(cpuset, \hyperlink{a00060_ga418ebb39eaf1eac8f9cf4047cf59a534}{hwloc_topology_get_complete_cpuset}(topology));
00157     \textcolor{keywordflow}{else}
00158       \hyperlink{a00065_ga6c540b9fe63b8223b6aba46d56dd63b8}{hwloc_bitmap_zero}(cpuset);
00159   \}
00160 
00161   \textcolor{keywordflow}{return} 0;
00162 \}
00163 
00173 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\hypertarget{a00034_source_l00174}{}\hyperlink{a00068_ga5b51a4a96a0c3ad9f4c0da308bbf4d8f}{00174} \hyperlink{a00068_ga5b51a4a96a0c3ad9f4c0da308bbf4d8f}{hwloc_nodeset_from_linux_libnuma_ulongs}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology, 
      \hyperlink{a00040_ga37e35730fa7e775b5bb0afe893d6d508}{hwloc_nodeset_t} nodeset,
00175                                         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} *mask, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} 
      maxnode)
00176 \{
00177   \textcolor{keywordtype}{int} depth = \hyperlink{a00046_gaea7c64dd59467f5201ba87712710b14d}{hwloc_get_type_depth}(topology, \hyperlink{a00041_ggacd37bb612667dc437d66bfb175a8dc55aaf0964881117bdedf1a5e9332cd120dd}{HWLOC_OBJ_NODE});
00178 
00179   \textcolor{keywordflow}{if} (depth != \hyperlink{a00046_ggaf4e663cf42bbe20756b849c6293ef575a0565ab92ab72cb0cec91e23003294aad}{HWLOC_TYPE_DEPTH_UNKNOWN}) \{
00180     \hyperlink{a00016}{hwloc_obj_t} node = NULL;
00181     \hyperlink{a00065_ga6c540b9fe63b8223b6aba46d56dd63b8}{hwloc_bitmap_zero}(nodeset);
00182     \textcolor{keywordflow}{while} ((node = \hyperlink{a00053_gab7c1dce3f42ece5bfa621e87cf332418}{hwloc_get_next_obj_by_depth}(topology, depth, node)) != NULL)
00183       \textcolor{keywordflow}{if} (node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index} < maxnode
00184           && (mask[node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index}/\textcolor{keyword}{sizeof}(*mask)/8] & (1UL << (node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index} % (\textcolor{keyword}{s
      izeof}(*mask)*8)))))
00185         \hyperlink{a00065_ga497556af0cc34f109ae0277999c074d3}{hwloc_bitmap_set}(nodeset, node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index});
00186   \} \textcolor{keywordflow}{else} \{
00187     \textcolor{comment}{/* if no numa, libnuma assumes we have a single node */}
00188     \textcolor{keywordflow}{if} (mask[0] & 1)
00189       \hyperlink{a00065_ga52456f7ef79d68e610cb65e3f7ffafad}{hwloc_bitmap_fill}(nodeset);
00190     \textcolor{keywordflow}{else}
00191       \hyperlink{a00065_ga6c540b9fe63b8223b6aba46d56dd63b8}{hwloc_bitmap_zero}(nodeset);
00192   \}
00193 
00194   \textcolor{keywordflow}{return} 0;
00195 \}
00196 
00215 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keyword}{struct }bitmask *
00216 \hyperlink{a00069_ga1a2ad777b9b4cf4aac0123f61c3ab8bd}{hwloc_cpuset_to_linux_libnuma_bitmask}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology, 
      \hyperlink{a00040_ga1f784433e9b606261f62d1134f6a3b25}{hwloc_const_cpuset_t} cpuset) \_\_hwloc\_attribute\_malloc;
00217 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keyword}{struct }bitmask *
\hypertarget{a00034_source_l00218}{}\hyperlink{a00069_ga1a2ad777b9b4cf4aac0123f61c3ab8bd}{00218} \hyperlink{a00069_ga1a2ad777b9b4cf4aac0123f61c3ab8bd}{hwloc_cpuset_to_linux_libnuma_bitmask}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology, 
      \hyperlink{a00040_ga1f784433e9b606261f62d1134f6a3b25}{hwloc_const_cpuset_t} cpuset)
00219 \{
00220   \textcolor{keywordtype}{int} depth = \hyperlink{a00046_gaea7c64dd59467f5201ba87712710b14d}{hwloc_get_type_depth}(topology, \hyperlink{a00041_ggacd37bb612667dc437d66bfb175a8dc55aaf0964881117bdedf1a5e9332cd120dd}{HWLOC_OBJ_NODE});
00221   \textcolor{keyword}{struct }bitmask *bitmask = numa\_allocate\_cpumask();
00222   \textcolor{keywordflow}{if} (!bitmask)
00223     \textcolor{keywordflow}{return} NULL;
00224 
00225   \textcolor{keywordflow}{if} (depth != \hyperlink{a00046_ggaf4e663cf42bbe20756b849c6293ef575a0565ab92ab72cb0cec91e23003294aad}{HWLOC_TYPE_DEPTH_UNKNOWN}) \{
00226     \hyperlink{a00016}{hwloc_obj_t} node = NULL;
00227     \textcolor{keywordflow}{while} ((node = \hyperlink{a00056_ga2f9a4ec15e9cfae8c21501257a51ce5b}{hwloc_get_next_obj_covering_cpuset_by_depth}(topology, cpuset, 
      depth, node)) != NULL)
00228       \textcolor{keywordflow}{if} (node->\hyperlink{a00016_a1dc830816716213b5f797e4052487864}{memory}.\hyperlink{a00020_aace044c7f3fd9dffe50202296bf1dc5a}{local_memory})
00229         numa\_bitmask\_setbit(bitmask, node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index});
00230   \} \textcolor{keywordflow}{else} \{
00231     \textcolor{comment}{/* if no numa, libnuma assumes we have a single node */}
00232     \textcolor{keywordflow}{if} (!\hyperlink{a00065_gaa94fed35d2a598bc4a8657b6955b7bf5}{hwloc_bitmap_iszero}(cpuset))
00233       numa\_bitmask\_setbit(bitmask, 0);
00234   \}
00235 
00236   \textcolor{keywordflow}{return} bitmask;
00237 \}
00238 
00248 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keyword}{struct }bitmask *
00249 \hyperlink{a00069_gab67a395c48ddb56307b1465fab9bb9e6}{hwloc_nodeset_to_linux_libnuma_bitmask}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology, 
      \hyperlink{a00040_ga2f5276235841ad66a79bedad16a5a10c}{hwloc_const_nodeset_t} nodeset) \_\_hwloc\_attribute\_malloc;
00250 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keyword}{struct }bitmask *
\hypertarget{a00034_source_l00251}{}\hyperlink{a00069_gab67a395c48ddb56307b1465fab9bb9e6}{00251} \hyperlink{a00069_gab67a395c48ddb56307b1465fab9bb9e6}{hwloc_nodeset_to_linux_libnuma_bitmask}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology, 
      \hyperlink{a00040_ga2f5276235841ad66a79bedad16a5a10c}{hwloc_const_nodeset_t} nodeset)
00252 \{
00253   \textcolor{keywordtype}{int} depth = \hyperlink{a00046_gaea7c64dd59467f5201ba87712710b14d}{hwloc_get_type_depth}(topology, \hyperlink{a00041_ggacd37bb612667dc437d66bfb175a8dc55aaf0964881117bdedf1a5e9332cd120dd}{HWLOC_OBJ_NODE});
00254   \textcolor{keyword}{struct }bitmask *bitmask = numa\_allocate\_cpumask();
00255   \textcolor{keywordflow}{if} (!bitmask)
00256     \textcolor{keywordflow}{return} NULL;
00257 
00258   \textcolor{keywordflow}{if} (depth != \hyperlink{a00046_ggaf4e663cf42bbe20756b849c6293ef575a0565ab92ab72cb0cec91e23003294aad}{HWLOC_TYPE_DEPTH_UNKNOWN}) \{
00259     \hyperlink{a00016}{hwloc_obj_t} node = NULL;
00260     \textcolor{keywordflow}{while} ((node = \hyperlink{a00053_gab7c1dce3f42ece5bfa621e87cf332418}{hwloc_get_next_obj_by_depth}(topology, depth, node)) != NULL)
00261       \textcolor{keywordflow}{if} (\hyperlink{a00065_ga2583f44cbdb5fff2ea40efdcf3975d3f}{hwloc_bitmap_isset}(nodeset, node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index}) && node->\hyperlink{a00016_a1dc830816716213b5f797e4052487864}{memory}.
      \hyperlink{a00020_aace044c7f3fd9dffe50202296bf1dc5a}{local_memory})
00262         numa\_bitmask\_setbit(bitmask, node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index});
00263   \} \textcolor{keywordflow}{else} \{
00264     \textcolor{comment}{/* if no numa, libnuma assumes we have a single node */}
00265     \textcolor{keywordflow}{if} (!\hyperlink{a00065_gaa94fed35d2a598bc4a8657b6955b7bf5}{hwloc_bitmap_iszero}(nodeset))
00266       numa\_bitmask\_setbit(bitmask, 0);
00267   \}
00268 
00269   \textcolor{keywordflow}{return} bitmask;
00270 \}
00271 
00277 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\hypertarget{a00034_source_l00278}{}\hyperlink{a00069_ga47747968f12c2674d2840dfbacce4940}{00278} \hyperlink{a00069_ga47747968f12c2674d2840dfbacce4940}{hwloc_cpuset_from_linux_libnuma_bitmask}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology, 
      \hyperlink{a00040_ga4bbf39b68b6f568fb92739e7c0ea7801}{hwloc_cpuset_t} cpuset,
00279                                         \textcolor{keyword}{const} \textcolor{keyword}{struct} bitmask *bitmask)
00280 \{
00281   \textcolor{keywordtype}{int} depth = \hyperlink{a00046_gaea7c64dd59467f5201ba87712710b14d}{hwloc_get_type_depth}(topology, \hyperlink{a00041_ggacd37bb612667dc437d66bfb175a8dc55aaf0964881117bdedf1a5e9332cd120dd}{HWLOC_OBJ_NODE});
00282 
00283   \textcolor{keywordflow}{if} (depth != \hyperlink{a00046_ggaf4e663cf42bbe20756b849c6293ef575a0565ab92ab72cb0cec91e23003294aad}{HWLOC_TYPE_DEPTH_UNKNOWN}) \{
00284     \hyperlink{a00016}{hwloc_obj_t} node = NULL;
00285     \hyperlink{a00065_ga6c540b9fe63b8223b6aba46d56dd63b8}{hwloc_bitmap_zero}(cpuset);
00286     \textcolor{keywordflow}{while} ((node = \hyperlink{a00053_gab7c1dce3f42ece5bfa621e87cf332418}{hwloc_get_next_obj_by_depth}(topology, depth, node)) != NULL)
00287       \textcolor{keywordflow}{if} (numa\_bitmask\_isbitset(bitmask, node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index}))
00288         \hyperlink{a00065_ga1ba1de709ee9a7cf5cc8ad2d9a1a81d4}{hwloc_bitmap_or}(cpuset, cpuset, node->\hyperlink{a00016_a67925e0f2c47f50408fbdb9bddd0790f}{cpuset});
00289   \} \textcolor{keywordflow}{else} \{
00290     \textcolor{comment}{/* if no numa, libnuma assumes we have a single node */}
00291     \textcolor{keywordflow}{if} (numa\_bitmask\_isbitset(bitmask, 0))
00292       \hyperlink{a00065_gab14743355fa03b36cef521cbcd2fbf64}{hwloc_bitmap_copy}(cpuset, \hyperlink{a00060_ga418ebb39eaf1eac8f9cf4047cf59a534}{hwloc_topology_get_complete_cpuset}(topology));
00293     \textcolor{keywordflow}{else}
00294       \hyperlink{a00065_ga6c540b9fe63b8223b6aba46d56dd63b8}{hwloc_bitmap_zero}(cpuset);
00295   \}
00296 
00297   \textcolor{keywordflow}{return} 0;
00298 \}
00299 
00305 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\hypertarget{a00034_source_l00306}{}\hyperlink{a00069_ga5a1d17375cc7b65cd155330008cbdb6a}{00306} \hyperlink{a00069_ga5a1d17375cc7b65cd155330008cbdb6a}{hwloc_nodeset_from_linux_libnuma_bitmask}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology, 
      \hyperlink{a00040_ga37e35730fa7e775b5bb0afe893d6d508}{hwloc_nodeset_t} nodeset,
00307                                          \textcolor{keyword}{const} \textcolor{keyword}{struct} bitmask *bitmask)
00308 \{
00309   \textcolor{keywordtype}{int} depth = \hyperlink{a00046_gaea7c64dd59467f5201ba87712710b14d}{hwloc_get_type_depth}(topology, \hyperlink{a00041_ggacd37bb612667dc437d66bfb175a8dc55aaf0964881117bdedf1a5e9332cd120dd}{HWLOC_OBJ_NODE});
00310 
00311   \textcolor{keywordflow}{if} (depth != \hyperlink{a00046_ggaf4e663cf42bbe20756b849c6293ef575a0565ab92ab72cb0cec91e23003294aad}{HWLOC_TYPE_DEPTH_UNKNOWN}) \{
00312     \hyperlink{a00016}{hwloc_obj_t} node = NULL;
00313     \hyperlink{a00065_ga6c540b9fe63b8223b6aba46d56dd63b8}{hwloc_bitmap_zero}(nodeset);
00314     \textcolor{keywordflow}{while} ((node = \hyperlink{a00053_gab7c1dce3f42ece5bfa621e87cf332418}{hwloc_get_next_obj_by_depth}(topology, depth, node)) != NULL)
00315       \textcolor{keywordflow}{if} (numa\_bitmask\_isbitset(bitmask, node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index}))
00316         \hyperlink{a00065_ga497556af0cc34f109ae0277999c074d3}{hwloc_bitmap_set}(nodeset, node->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index});
00317   \} \textcolor{keywordflow}{else} \{
00318     \textcolor{comment}{/* if no numa, libnuma assumes we have a single node */}
00319     \textcolor{keywordflow}{if} (numa\_bitmask\_isbitset(bitmask, 0))
00320       \hyperlink{a00065_ga52456f7ef79d68e610cb65e3f7ffafad}{hwloc_bitmap_fill}(nodeset);
00321     \textcolor{keywordflow}{else}
00322       \hyperlink{a00065_ga6c540b9fe63b8223b6aba46d56dd63b8}{hwloc_bitmap_zero}(nodeset);
00323   \}
00324 
00325   \textcolor{keywordflow}{return} 0;
00326 \}
00327 
00331 \textcolor{preprocessor}{#ifdef \_\_cplusplus}
00332 \textcolor{preprocessor}{}\} \textcolor{comment}{/* extern "C" */}
00333 \textcolor{preprocessor}{#endif}
00334 \textcolor{preprocessor}{}
00335 
00336 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HWLOC\_LINUX\_NUMA\_H */}
\end{DoxyCode}
