\hypertarget{a00036_source}{
\section{myriexpress.h}
}

\begin{DoxyCode}
00001 \textcolor{comment}{/*}
00002 \textcolor{comment}{ * Copyright © 2010-2012 inria.  All rights reserved.}
00003 \textcolor{comment}{ * Copyright © 2011 Cisco Systems, Inc.  All rights reserved.}
00004 \textcolor{comment}{ * See COPYING in top-level directory.}
00005 \textcolor{comment}{ */}
00006 
00015 \textcolor{preprocessor}{#ifndef HWLOC\_MYRIEXPRESS\_H}
00016 \textcolor{preprocessor}{}\textcolor{preprocessor}{#define HWLOC\_MYRIEXPRESS\_H}
00017 \textcolor{preprocessor}{}
00018 \textcolor{preprocessor}{#include <hwloc.h>}
00019 \textcolor{preprocessor}{#include <hwloc/autogen/config.h>}
00020 \textcolor{preprocessor}{#include <hwloc/linux.h>}
00021 
00022 \textcolor{preprocessor}{#include <myriexpress.h>}
00023 
00024 
00025 \textcolor{preprocessor}{#ifdef \_\_cplusplus}
00026 \textcolor{preprocessor}{}\textcolor{keyword}{extern} \textcolor{stringliteral}{"C"} \{
00027 \textcolor{preprocessor}{#endif}
00028 \textcolor{preprocessor}{}
00029 
00042 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\hypertarget{a00036_source_l00043}{}\hyperlink{a00073_ga87f4746d0cad579ce4e86b98088f22a1}{00043} \hyperlink{a00073_ga87f4746d0cad579ce4e86b98088f22a1}{hwloc_mx_board_get_device_cpuset}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology,
00044                                  \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{id}, \hyperlink{a00040_ga4bbf39b68b6f568fb92739e7c0ea7801}{hwloc_cpuset_t} \textcolor{keyword}{set})
00045 \{
00046   uint32\_t in, out;
00047 
00048   \textcolor{keywordflow}{if} (!\hyperlink{a00046_ga0d109e33fc7990f62f665d336e5e5111}{hwloc_topology_is_thissystem}(topology)) \{
00049     errno = EINVAL;
00050     \textcolor{keywordflow}{return} -1;
00051   \}
00052 
00053   in = id;
00054   \textcolor{keywordflow}{if} (mx\_get\_info(NULL, MX\_NUMA\_NODE, &in, \textcolor{keyword}{sizeof}(in), &out, \textcolor{keyword}{sizeof}(out)) != MX\_S
      UCCESS) \{
00055     errno = EINVAL;
00056     \textcolor{keywordflow}{return} -1;
00057   \}
00058 
00059   \textcolor{keywordflow}{if} (out != (uint32\_t) -1) \{
00060     \hyperlink{a00016}{hwloc_obj_t} obj = NULL;
00061     \textcolor{keywordflow}{while} ((obj = \hyperlink{a00053_ga5f08ceb69375341e73563cfe2e77534e}{hwloc_get_next_obj_by_type}(topology, \hyperlink{a00041_ggacd37bb612667dc437d66bfb175a8dc55aaf0964881117bdedf1a5e9332cd120dd}{HWLOC_OBJ_NODE}, obj)) != N
      ULL)
00062       \textcolor{keywordflow}{if} (obj->\hyperlink{a00016_a61a7a80a68eaccbaaa28269e678c81a9}{os_index} == out) \{
00063         \hyperlink{a00065_gab14743355fa03b36cef521cbcd2fbf64}{hwloc_bitmap_copy}(\textcolor{keyword}{set}, obj->\hyperlink{a00016_a67925e0f2c47f50408fbdb9bddd0790f}{cpuset});
00064         \textcolor{keywordflow}{goto} out;
00065       \}
00066   \}
00067   \textcolor{comment}{/* fallback to the full topology cpuset */}
00068   \hyperlink{a00065_gab14743355fa03b36cef521cbcd2fbf64}{hwloc_bitmap_copy}(\textcolor{keyword}{set}, \hyperlink{a00060_ga418ebb39eaf1eac8f9cf4047cf59a534}{hwloc_topology_get_complete_cpuset}(topology));
00069 
00070  out:
00071   \textcolor{keywordflow}{return} 0;
00072 \}
00073 
00082 \textcolor{keyword}{static} \_\_hwloc\_inline \textcolor{keywordtype}{int}
\hypertarget{a00036_source_l00083}{}\hyperlink{a00073_ga2ff7763b9c2c5975f9a2e3d638351535}{00083} \hyperlink{a00073_ga2ff7763b9c2c5975f9a2e3d638351535}{hwloc_mx_endpoint_get_device_cpuset}(\hyperlink{a00039_ga9d1e76ee15a7dee158b786c30b6a6e38}{hwloc_topology_t} topology,
00084                                     mx\_endpoint\_t endpoint, \hyperlink{a00040_ga4bbf39b68b6f568fb92739e7c0ea7801}{hwloc_cpuset_t} \textcolor{keyword}{set})
00085 \{
00086   uint64\_t nid;
00087   uint32\_t nindex, eid;
00088   mx\_endpoint\_addr\_t eaddr;
00089 
00090   \textcolor{keywordflow}{if} (mx\_get\_endpoint\_addr(endpoint, &eaddr) != MX\_SUCCESS) \{
00091     errno = EINVAL;
00092     \textcolor{keywordflow}{return} -1;
00093   \}
00094 
00095   \textcolor{keywordflow}{if} (mx\_decompose\_endpoint\_addr(eaddr, &nid, &eid) != MX\_SUCCESS) \{
00096     errno = EINVAL;
00097     \textcolor{keywordflow}{return} -1;
00098   \}
00099 
00100   \textcolor{keywordflow}{if} (mx\_nic\_id\_to\_board\_number(nid, &nindex) != MX\_SUCCESS) \{
00101     errno = EINVAL;
00102     \textcolor{keywordflow}{return} -1;
00103   \}
00104 
00105   \textcolor{keywordflow}{return} \hyperlink{a00073_ga87f4746d0cad579ce4e86b98088f22a1}{hwloc_mx_board_get_device_cpuset}(topology, nindex, \textcolor{keyword}{set});
00106 \}
00107 
00111 \textcolor{preprocessor}{#ifdef \_\_cplusplus}
00112 \textcolor{preprocessor}{}\} \textcolor{comment}{/* extern "C" */}
00113 \textcolor{preprocessor}{#endif}
00114 \textcolor{preprocessor}{}
00115 
00116 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* HWLOC\_MYRIEXPRESS\_H */}
\end{DoxyCode}
